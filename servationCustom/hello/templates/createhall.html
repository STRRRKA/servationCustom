{% extends "index.html" %}
{% block content %}
{% load static %}
<div id="test"></div>
    <div class="openedSession" id="OS">
        <input type="text" id="rows">
        <input type="text" id="columns">
        <button id="btnCreate">Создать</button>
        
        <div class="chairsbar">
            <div id="chairs">
                <img src = "{% static "images/chair.png" %}" >
            </div>
            <div id="sofas">
                <img src = "{% static "images/sofa.png" %}" >
            </div>
            <div id="reset">reset</div>
        </div>

    </div> 
    <script>
        let status;
        let chair = document.getElementById('chairs');
        let sofa = document.getElementById('sofas');
        let reset = document.getElementById('reset');
        reset.onclick = setReset;
        chair.onclick = setChair;
        sofa.onclick = setSofa;
        function setChair(){
            status = "chair";
        }
        function setSofa(){
            status = "sofa";
        }
        function setReset(){
            status = "reset";
        }
        let btn = document.getElementById('btnCreate');
        btn.onclick = crt;
        function crt(e){
            let row = document.getElementById('rows').value;
            let column = document.getElementById('columns').value;
            let container = document.createElement('div');
            container.classList.add("grid-container");
            let str = "grid" + ":repeat(" + row + ",70px)/repeat(" + column + ", 70px);";
            container.style = str;
            let os = document.getElementById('OS');
            os.appendChild(container);
            
            
            for (let i=1; i<=parseInt(row)*parseInt(column); i++){
                let item = document.createElement('div');
                item.setAttribute('id', i);
                item.classList.add("grid-item");
                item.classList.add("free");
                // let img = '<img src = "{% static "images/chair.png" %}" >'; 
                // item.innerHTML = img;
                item.onclick=change;
                function change(e){
                    if(status == "chair"){
                        e.target.innerHTML = '<img src = "{% static "images/chair.png" %}" >';
                        //e.target.classList.add("selected");
                    }
                    else if (status == "sofa"){
                        e.target.innerHTML = '<img src = "{% static "images/sofa.png" %}" >';
                        // e.target.classList.remove("selected");
                        // e.target.classList.add("free");                     
                    }
                    else {
                        e.target.innerHTML = '';
                    }
                }
                container.appendChild(item);
            }
            let maindiv = document.getElementById('OS');

            let form = document.createElement('form');
            form.addEventListener('submit', function(event) { // 1
            event.preventDefault()
            let data = new FormData();
            data.append("csrfmiddlewaretoken", '{{csrf_token}}');
            data.append("code", maindiv.innerHTML );
            axios.post('', data) // 4
              .then(res => alert("Form Submitted")) // 5
              .catch(errors => console.log(errors))
         });
        form.name="formmain";
        form.action='';
        form.method='POST';
        form.innerHTML='{% csrf_token %} <button id="savebutton">save2<button>';
        let divtest = document.getElementById('test');
        divtest.appendChild(form);
        let svbtn = document.getElementById('savebutton');
        svbtn.onclick = saveclick;
        container.appendChild(savebutton);
        function saveclick(){
           form.submit();
           
        }
        
        
        }


    </script>
{% endblock content %}